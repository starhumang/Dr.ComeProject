<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{hospital/hospitalLayout}">
<head>
<meta charset="UTF-8" />
<title>select Pharmacy List</title>
<style>
.head_info {
	display: flex;
	justify-content: space-between;
	margin-top: 30px;
}
</style>
</head>
<body>
	<div layout:fragment="content">
		<div class="container-fluid">
			<!-- 날짜 및 병원 정보 헤더 -->
			<div class="head_info">
				<h4 th:text="${hospitalSel.hospitalName}"></h4>
				<p>
					<i class="fas fa-fw fa-calendar"></i> 현재날짜 : <span
						th:text="${#calendars.format(#calendars.createNow(), 'yyyy-MM-dd')}"></span>
				</p>
			</div>
			<p>약국 선택 리스트</p>
			<p>클리닉 번호 : [[${pharList[0].clinicNo}]]</p>
			<p>처방전 현황 : [[${perscrip}]]</p>
			


			<div  style="display:flex; justify-content:space-between; align-items: center; margin-bottom: 1.0rem;">
				<h5 style="margin:0;">환자 선택 약국리스트</h5>
				<div>
					<button class="btn btn-info" onclick="sendSelectedData()">선택전송</button>
					<button class="btn btn-primary" onclick="sendAllData()">일괄전송</button>
				</div>
			</div>
			
			<!-- 약국 선택 리스트 -->
			<div>
				<table class="table">
					<thead>
						<tr>
							<th class="check"><input type="checkbox" id="selectAll"></th>
							<th>No.</th>
							<th>약국명</th>
							<th>처방날짜</th>
							<th>전화번호</th>
							<th>전송하기</th>
						</tr>
					</thead>
					<tbody>
			<tr th:each="phl, iterStat : ${pharList}">
	            <td class="check"><input type="checkbox" class="checkItem" value="[[${phl.pharmacySelectno}]]"></td>
	            <td th:text="${phl.pharmacySelectno}"></td>
	            <td th:text="${phl.pharmacyName}"></td>
	            <td th:text="${phl.perscriptionDate}"></td>
	            <td th:text="${phl.pharmacyPhone}"></td>
	            <td><button class="btn btn-dark" onclick="sendData('[[${phl.pharmacySelectno}]]', '[[${phl.pharmacyName}]]', '[[${phl.perscriptionDate}]]', '[[${phl.pharmacyPhone}]]')">전송</button></td>
            </tr>
					</tbody>
				</table>
			</div>
				
			<script>
			    const selectAllCheckbox = document.getElementById('selectAll');
			    const checkboxes = document.querySelectorAll('.checkItem');
			
			 	// 전체 선택/해제
			    selectAllCheckbox.addEventListener('change', function() {
			        checkboxes.forEach(checkbox => {
			            checkbox.checked = selectAllCheckbox.checked;
			        });
			    });
			
			    // 개별 체크박스 변경 시
				checkboxes.forEach(checkbox => {
				    checkbox.addEventListener('change', function() {
				        let allChecked = true;
				        let selectedValues = [];
				        checkboxes.forEach(cb => {
				            if (!cb.checked) {
				                allChecked = false;
				            } else {
				                selectedValues.push(cb.value);
				            }
				        });
				        console.log('전체 선택된 값:', selectedValues);
				    });
				});
			
			    // 전송 함수
			    function sendData(selectedValues, name, date, phone) {
			        console.log('선택된 값:', selectedValues);
			        console.log('약국명:', name, '처방날짜:', date, '전화번호:', phone);
			    }
			    
			    function sendSelectedData() {
			        let selectedValues = [];
			        checkboxes.forEach(checkbox => {
			            if (checkbox.checked) {
			                selectedValues.push(checkbox.value);
			            }
			        });
			        console.log('선택된 값:', selectedValues);
			    }
			
			    function sendAllData() {
			        let allValues = [];
			        checkboxes.forEach(checkbox => {
			            allValues.push(checkbox.value);
			        });
			        console.log('모든 값:', allValues);
			    }
			</script>

		</div>
	</div>
</body>
</html>
