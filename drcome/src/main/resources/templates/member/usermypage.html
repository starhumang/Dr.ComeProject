<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}"
>
	<head>
		<meta charset="UTF-8" />
		<title>마이페이지</title>
		<style>
			.head_info {
				display: flex;
				justify-content: space-between;
				margin-top: 30px;
			}
			.right {
				width: 60%;
			}
		</style>

		<script th:inline="javascript">
			const userId = [[${session.userId}]];

			function goToModify() {
				location.href = '/userupdate';
			}

			function withdraw() {
				Swal.fire({
					title: '회원 탈퇴',
					html: `<p>회원 탈퇴 시 사용자 정보가 모두 삭제됩니다.</p><p>계속하려면 비밀번호를 입력해주세요.</p><input type="password" id="password" class="swal2-input" placeholder="비밀번호를 입력하세요">`,
					icon: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#d33',
					cancelButtonColor: '#3085d6',
					confirmButtonText: '탈퇴하기',
					cancelButtonText: '취소하기',
				}).then((result) => {
					if (result.isConfirmed) {
						// 사용자가 입력한 비밀번호 가져오기
						const password = document.getElementById('password').value;
						withdrawProcess(password);
					}
				});
			}

			function withdrawProcess(password) {
				$.ajax({
					type: 'GET',
					url: '/userdelete',
					data: { userId: userId, password: password },
					success: function (response) {
						if (response === -1) {
							Swal.fire({
								title: '비밀번호 오류',
								text: '비밀번호가 일치하지 않습니다.',
								icon: 'error',
								confirmButtonColor: '#3085d6',
							});
						} else {
							Swal.fire({
								title: '탈퇴 성공',
								text: '회원 탈퇴가 성공적으로 이루어졌습니다.',
								icon: 'success',
								confirmButtonColor: '#3085d6',
							}).then((result) => {
								if (result.isConfirmed) {
									location.href = '/';
								}
							});
						}
					},
					error: function (xhr, status, error) {
						console.error(error);
						Swal.fire({
							icon: 'error',
							text: '오류가 발생했습니다.',
						});
					},
				});
			}
		</script>
	</head>
	<body>
		<div layout:fragment="content">

			<h1 style="text-align: center; margin-bottom: 50px; margin-top: 50px; color: gray">- My Info -</h1>
			<div class="container-fluid" style="margin-bottom: 150px">
				<div class="container" style="margin-bottom: 50px">
					<div class="card shadow mb-4">
						<div
							class="card-header py-3"
							style="display: flex; justify-content: space-between; align-items: center"
						>
							<h5 class="m-0 font-weight-bold text-secondary">
								<i class="fas fa-fw fa-user-nurse"></i>내 정보
							</h5>
						</div>

						<div class="card-body" style="display: flex; justify-content: center; align-items: center">
							<!-- <div class="left">
								<p>여기</p>
							</div> -->
							<div class="right" style="text-align: center">
								<h3
									th:text="'[ ' + ${profile.userName} + ' ] 님'"
									class="font-weight-bold text-secondary"
									style="margin-bottom: 30px; margin-top: 20px"
								></h3>
								<table class="table" style="text-align: center">
									<tr>
										<th style="text-align: left; width: 200px; padding-left: 30px">- 아이디</th>
										<td th:text="${profile.userId}"></td>
									</tr>
									<tr>
										<th style="text-align: left; padding-left: 30px">- 전화번호</th>
										<td th:text="${profile.phone}"></td>
									</tr>
									<tr>
										<th style="text-align: left; padding-left: 30px">- 생년월일</th>
										<td th:text="${#dates.format(profile.birthday, 'yyyy-MM-dd')}"></td>
									</tr>
									<tr>
										<th style="text-align: left; padding-left: 30px">- 성별</th>
										<td>
											<span th:if="${profile.gender == 'F'}">여자</span>
											<span th:if="${profile.gender == 'M'}">남자</span>
										</td>
									</tr>
								</table>
								<div class="butt">
									<button class="btn btn-secondary" id="btn" onclick="goToModify()">회원수정</button>
									<button class="btn btn-danger" id="btn" onclick="withdraw()">회원탈퇴</button>
							</div>
						</div>
					</div>
				</div>

				<div class="container" style="margin-bottom: 50px">
					<div class="card shadow mb-4">
						<div
							class="card-header py-3"
							style="display: flex; justify-content: space-between; align-items: center"
						>
							<h5 class="m-0 font-weight-bold text-secondary">
								<i class="fas fa-fw fa-hospital"></i>예약/진료 내역
							</h5>
						</div>

						<div class="card-body" style="display: flex; justify-content: center; align-items: center">
							<table class="table table-hover" th:if="${reserveMyList != null and not #lists.isEmpty(reserveMyList)}">
								<thead>
									<tr>
										<th>예약코드</th>
										<th>증상</th>
										<th>방문 일자</th>
										<th>방문 시간</th>
										<th>병원 이름</th>
										<th>병원 전화번호</th>
										<th>담당의</th>
										<th>예약종류</th>
										<th>예약상태</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="rdl : ${reserveMyList}">
										<td th:text="${rdl.reserveNo}"></td>
										<td th:text="${rdl.symptom}"></td>
										<td th:text="${rdl.reserveDate}"></td>
										<td th:text="${rdl.reserveTime}"></td>
										<td th:text="${rdl.hospitalName}"></td>
										<td th:text="${rdl.hospitalPhone}"></td>
										<td th:text="${rdl.doctorName}"></td>
										<td th:if="${ rdl.reserveKindstatus == 'c1' }">대면</td>
										<td th:unless="${ rdl.reserveKindstatus == 'c1' }">비대면</td>
										<td>
											<button
												disabled
												th:if="${rdl.reserveStatus} =='e1'"
												class="btn btn-secondary"
											>
												진료대기
											</button>
											<button
												th:if="${rdl.reserveStatus} =='e3'"
												th:onclick="enter([[${rdl.reserveNo}]])"
												class="btn btn-primary enterBtn"
											>
												입장하기
											</button>
											<button disabled th:if="${rdl.reserveStatus} =='e4' OR ${rdl.reserveStatus} =='e5'"  class="btn btn-light">
												진료완료
											</button>
										</td>
									</tr>
								</tbody>
							</table>
							<div th:unless="${reserveMyList != null and not #lists.isEmpty(reserveMyList)}">
								<p>예약/진료 내역이 없습니다.</p>
							</div>
						</div>
					</div>
				</div>

				<div class="container" style="margin-bottom: 50px">
					<div class="card shadow mb-4">
						<div
							class="card-header py-3"
							style="display: flex; justify-content: space-between; align-items: center"
						>
							<h5 class="m-0 font-weight-bold text-secondary">
								<i class="fas fa-fw fa-search-location"></i>문의 내역
							</h5>
						</div>

						<div class="card-body" style="display: flex; justify-content: center; align-items: center">
						</div>
					</div>
				</div>

			</div>

			<script>
				function enter(rNo) {
					// console.log(rNo);
					location.href = '/untactPatient/' + rNo;
				}
			</script>
		</div>
	</body>
</html>
