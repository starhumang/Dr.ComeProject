<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}"
>
	<head>
		<meta charset="UTF-8" />

		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.all.min.js"></script>
		<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.min.css" rel="stylesheet" />

		<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>

		<script type="text/javascript">
			function errAlert(content) {
				Swal.fire({
					icon: 'error',
					text: content,
				});
			}
		</script>
	</head>
	<body>
		<div layout:fragment="content">
			<p>마아아이이이페에에에이이이지이이이</p>
			<!-- <p th:text="${profile}"></p> -->
			<p id="userId" th:text="${session.userId}"></p>
			<!-- <div><img th:src="@{/img/{img}(img= ${profile.identification})}" width="300px" height="300px" /></div> -->
			<p>전체코드</p>
			<!-- <p th:text="${application.detailCode}"></p> -->
			<p>개별코드</p>
			<!-- [[${application.detailCode_a}]] -->

			<h1>WebSocket Test</h1>
			<button onclick="connectWebSocket()">Connect WebSocket</button>
			<button onclick="sendMessage()">Send Message</button>
			<div id="messages"></div>

			<script>
				let socket;
				let userId = document.querySelector('#userId').innerHTML;
				function connectWebSocket() {
					console.log(userId);
					try {
						// WebSocket 연결
						socket = new WebSocket('ws://localhost:80/echo');

						// 연결이 열리면 호출되는 이벤트 핸들러
						socket.onopen = function (event) {
							console.log('WebSocket 연결이 열렸습니다.');
							// /topic/messages 토픽을 구독합니다.
							socket.send('연결 시작'); // Change this line
						};

						// 메시지를 받았을 때 호출되는 이벤트 핸들러
						socket.onmessage = function (event) {
							console.log('받은 메시지: ' + event.data);
							displayMessage(event.data);
						};

						// 연결이 닫혔을 때 호출되는 이벤트 핸들러
						socket.onclose = function (event) {
							console.log('WebSocket 연결이 닫혔습니다.');
						};

						// 에러가 발생했을 때 호출되는 이벤트 핸들러
						socket.onerror = function (error) {
							console.error('WebSocket 연결 에러:', error);
						};
					} catch (error) {
						console.error('WebSocket 연결 에러:', error);
					}
				}

				function sendMessage() {
					try {
						if (socket && socket.readyState === WebSocket.OPEN) {
							// 서버로 메시지 전송
							const message = '문자 전송';
							socket.send(message);
							console.log('보낸 메시지: ' + message);
						} else {
							console.error('WebSocket 연결이 열려있지 않습니다.');
						}
					} catch (error) {
						console.error('WebSocket 메시지 전송 에러:', error);
					}
				}

				function displayMessage(message) {
					// 받은 메시지를 화면에 표시
					const messagesDiv = document.getElementById('messages');
					const messageDiv = document.createElement('div');
					messageDiv.textContent = message;
					messagesDiv.appendChild(messageDiv);
				}
			</script>
		</div>
	</body>
</html>
