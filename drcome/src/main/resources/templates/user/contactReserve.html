<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<head>
<meta charset="UTF-8" />
<title>방문예약</title>
<script type="text/javascript"
	src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7be6b1f8b5b642b5d341f732b8dc384e&libraries=services"></script>
<script
	src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.all.min.js"></script>
<link
	href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.4/dist/sweetalert2.min.css"
	rel="stylesheet" />

<!-- 달력 -->
<script src="https://code.jquery.com/jquery-3.2.1.js"></script>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet"
	href="resources/css/plugin/datepicker/bootstrap-datepicker.css">

<script src="https://code.jquery.com/jquery-3.2.1.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ko.min.js"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.js"></script>

<style>
.bb {
	display: inline;
	width: 200px;
	height: 60px;
	margin: 10px 10px 10px 10px;
}

}
.butt {
	display: flex;
}

.body {
	color: #000;
	overflow-x: hidden;
	height: 100%;
	padding: 0px !important;
}

.container-fluid {
	padding-top: 120px !important;
	padding-bottom: 120px !important;
}

.card {
	box-shadow: 0px 4px 8px 0px #7986CB;
}

.input {
	padding: 10px 20px !important;
	border: 1px solid #000 !important;
	border-radius: 10px;
	box-sizing: border-box;
	background-color: #616161 !important;
	color: #fff !important;
	font-size: 16px;
	letter-spacing: 1px;
	width: 180px;
	display: inline;
}

.input:focus {
	-moz-box-shadow: none !important;
	-webkit-box-shadow: none !important;
	box-shadow: none !important;
	border: 1px solid #512DA8;
	outline-width: 0;
}

::placeholder {
	color: #fff;
	opacity: 1;
}

:-ms-input-placeholder {
	color: #fff;
}

::-ms-input-placeholder {
	color: #fff;
}

.datepicker {
	background-color: #000 !important;
	color: #fff !important;
	border: none;
	padding: 10px !important;
}

.datepicker-dropdown:after {
	border-bottom: 6px solid #000;
}

thead tr:nth-child(3) th {
	color: #fff !important;
	font-weight: bold;
	padding-top: 20px;
	padding-bottom: 10px;
}

.dow, .old-day, .day, .new-day {
	width: 40px !important;
	height: 40px !important;
	border-radius: 0px !important;
}

.old-day:hover, .day:hover, .new-day:hover, .month:hover, .year:hover,
	.decade:hover, .century:hover {
	border-radius: 6px !important;
	background-color: #eee;
	color: #000;
}

.active {
	border-radius: 6px !important;
	background-image: linear-gradient(#90CAF9, #64B5F6) !important;
	color: #000 !important;
}

.disabled {
	color: #616161 !important;
}

.prev, .next, .datepicker-switch {
	border-radius: 0 !important;
	padding: 20px 10px !important;
	text-transform: uppercase;
	font-size: 20px;
	color: #fff !important;
	opacity: 0.8;
}

.prev:hover, .next:hover, .datepicker-switch:hover {
	background-color: inherit !important;
	opacity: 1;
}

.cell {
	border: 1px solid #BDBDBD;
	margin: 2px;
	cursor: pointer;
}

.cell:hover {
	border: 1px solid #3D5AFE;
}

.cell.select {
	background-color: #3D5AFE;
	color: #fff;
}

.fa-calendar {
	color: #fff;
	font-size: 30px;
	padding-top: 8px;
	padding-left: 5px;
	cursor: pointer;
}
</style>
</head>

<body>
	<div layout:fragment="content">
		<h1 style="text-align: center; margin-top: 50px; color: gray;">[
			방문예약 ]</h1>
		<div class="container-fluid" style="margin-bottom: 50px; width: 75%">

			<!-- 병원이름 -->
			<div class="container" style="margin-bottom: 50px;">
				<div class="card shadow mb-4">
					<!-- 소제목 -->
					<div class="card-header py-3"
						style="display: flex; align-items: center;">
						<h5 class="m-0 font-weight-bold text-secondary">
							<i class="fas fa-fw fa-hospital"></i>예약하는 병원 :
						</h5>
						<h5 class="font-weight-bold me"
							style="color: #06BBCC; margin: 0 0 0 10px;" th:text="${hosName}">
						</h5>
					</div>
				</div>
			</div>

			<!-- 의사정보 -->
			<div class="container" style="margin-bottom: 50px;">
				<div class="card shadow mb-4">
					<div class="card-header py-3"
						style="display: flex; align-items: center;">
						<h5 class="m-0 font-weight-bold text-secondary">
							<i class="fas fa-fw fa-user-nurse"></i>선택한 의료진 :
						</h5>
						<h5 class="font-weight-bold name"
							style="color: #06BBCC; margin: 0 0 0 10px;"></h5>
					</div>
				</div>
				<div class="card-body" style="text-align: center;">
					<table class="table">
						<thead>
							<tr>
								<th></th>
								<th>의사이름</th>
								<th>담당진료과목</th>
								<th>휴진일</th>
								<th>진료일 / 진료시간</th>
							</tr>
						</thead>
						<tbody style="vertical-align: middle;">
							<th:block th:each="doc : ${docList}">
								<tr th:if="${#lists.size(docList) > 0}">
									<td><input type="radio" name="doctor"
										onclick="chooseDoctor()" /></td>
									<td class="docName" th:text="${doc.doctorName}"></td>
									<td th:text="${doc.subject}"></td>
									<td class="docHol" th:text="${doc.holiday}"></td>
									<td>
										<div th:each="drTime : ${doc.times}">
											[[${drTime.day}]]&nbsp&nbsp [[${drTime.minTime}]] : 00 ~
											[[${drTime.maxTime}]] : 00</div>
									</td>
								</tr>
							</th:block>
						</tbody>
					</table>
				</div>
			</div>

			<!-- 날짜 및 시간선택버튼 -->
			<div class="container" style="margin-bottom: 50px;">
				<div class="card shadow mb-4 body">

					<div
						style="display: flex; justify-content: left; align-items: center;">
						<!-- 제목 -->
						<div class=" py-3" style="width: 550px; padding-left: 20px;">
							<h5 class="m-0 font-weight-bold text-secondary"
								style="display: inline;">
								<i class="fa fa-calendar text-secondary"
									style="font-size: 21px; margin-right: 5px;"></i>선택한 날짜 :
							</h5>
							<h5 class="font-weight-bold date"
								style="display: inline; color: #06BBCC; margin: 0 0 0 10px;">
							</h5>
						</div>
						<div class=" py-3" style="width: 550px; padding-left: 20px;">
							<h5 class="m-0 font-weight-bold text-secondary"
								style="display: inline;">
								<i class="fa fa-clock text-secondary"
									style="font-size: 21px; margin-right: 5px;"></i>선택한 시간 :
							</h5>
							<h5 class="font-weight-bold time"
								style="display: inline; color: #06BBCC; margin: 0 0 0 10px;">
							</h5>

						</div>
					</div>

					<!-- 우선 body 부분에 input tag를 하나 만들어준다. -->
					<!-- 시작시 기본 날짜 설정은 value를 이용 -->
					<div class="justify-content-center" style="width: 100%">
						<div style="width: 100%;">
							<div class="card border-0">
								<form autocomplete="off">
									<div class="card-header bg-dark" style="text-align: center;">
										<div
											class="mx-0 mb-0 justify-content-sm-center justify-content-start px-1">
											<input type="text" id="datePicker" class="datepicker one"
												placeholder="날짜를 선택해주세요" name="date" readonly> <span
												class="fa fa-calendar"></span>
										</div>
									</div>
									<div class="card-body p-3 p-sm-5">
										<div class="row text-center mx-0">
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">9:00AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">9:30AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">9:45AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">10:00AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">10:30AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">10:45AM</div>
											</div>
										</div>
										<div class="row text-center mx-0">
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">11:00AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">11:30AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">11:45AM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">12:00PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">12:30PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">12:45PM</div>
											</div>
										</div>
										<div class="row text-center mx-0">
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">1:00PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">1:30PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">1:45PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">2:00PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">2:30PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">2:45PM</div>
											</div>
										</div>
										<div class="row text-center mx-0">
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">3:00PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">3:30PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">4:15PM</div>
											</div>
											<div class="col-md-2 col-4 my-1 px-2">
												<div class="cell py-1">5:00PM</div>
											</div>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>

					<script type="text/javascript"> 
						
							//병원 및 의사 휴무일 지정중
							let docName = null; //이거는 의사선택 전 날짜 못 고르게 하는 장치
							let hosHoliday = [[${newDate}]]; //병원 쉬는날
							console.log("hosHoliday : ", hosHoliday)
							let docHoliday = null; //의사 쉬는날
							let restday = []; //병원 + 의사 쉬는날
							//console.log(docHoliday);
							
							
							//페이지 열었을때 바로 시작되는 함수
							window.onload = function(){
								if(docName==null){
									document.querySelector('.one').disabled=true;
								}
							}
							
							//의사 선택
							function chooseDoctor(){
								let basicHosHoliDay = hosHoliday
								let tr= document.querySelector('input[name="doctor"]:checked').closest('tr');
								let docName = tr.querySelector('.docName').innerText;
								let holiday = tr.querySelector('.docHol').innerText;
								document.querySelector('.name').innerText=docName; //이름뽑아오기
								document.querySelector('.one').disabled=false; //날짜선택 disabled걸린거 풀기
								document.querySelector('.one').value = null;
								
								let dayList = {"i1": 1 ,"i2": 2,"i3": 3,"i4": 4,"i5": 5 ,"i6": 6,"i7" : 0}
								
								let restday = [];
								//자르기
								if(holiday.length > 2){
									//hosHoliday=''
									let splitHoliday = holiday.split(',');
									splitHoliday.forEach((ele)=>{
									let array = [dayList[ele]];
									basicHosHoliDay = basicHosHoliDay.concat(array);
									})
									//hosHoliday.push(hosHoliday);//병원 쉬는날도 같이
								}else{
									let array = [dayList[holiday]];
									basicHosHoliDay = basicHosHoliDay.concat(array);
									//hosHoliday.push(hosHoliday);//병원 쉬는날도 같이
								}
								
								
								console.log("hosHoliday00",basicHosHoliDay);

								createDatePicker(basicHosHoliDay)
								
							}
							
							function createDatePicker(hosHoliday){
								
								$('#datePicker').datepicker("destroy");
						
								$('#datePicker')
							      .datepicker({
							         format: 'yyyy-mm-dd', //데이터 포맷 형식(yyyy : 년 mm : 월 dd : 일 )
							         startDate: '1d', //달력에서 선택 할 수 있는 가장 빠른 날짜. 이전으로는 선택 불가능 ( d : 일 m : 달 y : 년 w : 주)
							         endDate: '+10d', //달력에서 선택 할 수 있는 가장 느린 날짜. 이후로 선택 불가 ( d : 일 m : 달 y : 년 w : 주)
							         autoclose: true, //사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
							         datesDisabled: ['2019-06-24', '2019-06-26'], //선택 불가능한 일 설정 하는 배열 위에 있는 format 과 형식이 같아야함.
							         daysOfWeekDisabled: hosHoliday, //선택 불가능한 요일 설정 0 : 일요일 ~ 6 : 토요일
							         disableTouchKeyboard: false, //모바일에서 플러그인 작동 여부 기본값 false 가 작동 true가 작동 안함.
							         immediateUpdates: true, //사용자가 보는 화면으로 바로바로 날짜를 변경할지 여부 기본값 :false
							         multidate: false, //여러 날짜 선택할 수 있게 하는 옵션 기본값 :false
							         multidateSeparator: ',', //여러 날짜를 선택했을 때 사이에 나타나는 글짜 2019-05-01,2019-06-01
							         templates: {
							            leftArrow: '&laquo;',
							            rightArrow: '&raquo;',
							         }, //다음달 이전달로 넘어가는 화살표 모양 커스텀 마이징
							         showWeekDays: true, // 위에 요일 보여주는 옵션 기본값 : true
							         todayHighlight: true, //오늘 날짜에 하이라이팅 기능 기본값 :false
							         toggleActive: true, //이미 선택된 날짜 선택하면 기본값 : false인경우 그대로 유지 true인 경우 날짜 삭제
							         weekStart: 0, //달력 시작 요일 선택하는 것 기본값은 0인 일요일
							      })
							      .on('changeDate', function (e) {
							         //날짜가 변경되고 일어나는 이벤트
							         let date = document.querySelector('.datepicker').value;
							         document.querySelector('.date').innerText=date;
							         // e.date를 찍어보면 Thu Jun 27 2019 00:00:00 GMT+0900 (한국 표준시) 위와 같은 형태로 보인다.
							      });
								
							}
					
						
						 
						</script>
				</div>
			</div>

			<!-- 증상적는곳 -->
			<div class="container" style="margin-bottom: 50px;">
				<div class="card shadow mb-4">
					<div class="card-header py-3"
						style="display: flex; align-items: center;">
						<h5 class="m-0 font-weight-bold text-secondary">
							<i class="fas fa-fw fa-check"
								style="font-size: 21px; margin-right: 5px;"></i>증상을 적어주세요
						</h5>
						<h5 class="m-0 font-weight-bold text-secondary me"></h5>
					</div>
					<div class="card-body"
						style="display: flex; justify-content: center; align-items: center;">
					</div>
				</div>
			</div>

		</div>
	</div>


</body>

</html>